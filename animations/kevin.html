<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=0.8">
        <title>Document</title>
    </head>
    <body>
        <svg viewBox="0 0 750 1000" width="500" height="1000" xmlns="http://www.w3.org/2000/svg">
            <g transform="translate(0, -20)">
                <rect x="20" y="50" width="160" height="160" fill="white" stroke-width="2" stroke="black"/>
                <ellipse cx="100" cy="50" rx="80" ry="20" fill="white" stroke-width="2" stroke="black"/>
                <rect x="20" y="160" width="160" height="50" fill="#f58b8b" stroke-width="2" stroke="black" id="cuveR"/>
                <ellipse cx="100" cy="160" rx="80" ry="20" fill="#fd4444" stroke-width="2" stroke="black" id="elipsHR"/>
                <ellipse cx="100" cy="210" rx="80" ry="20" fill="#960000" stroke-width="2" stroke="black" id="elipsBR"/>
            </g>
            <g transform="translate(0, 200)">
                <rect x="20" y="50" width="160" height="160" fill="white" stroke-width="2" stroke="black"/>
                <ellipse cx="100" cy="50" rx="80" ry="20" fill="white" stroke-width="2" stroke="black"/>
                <rect x="20" y="50" width="160" height="160" fill="#8ab386" stroke-width="2" stroke="black" id="cuveV"/>
                <ellipse cx="100" cy="50" rx="80" ry="20" fill="#007e00" stroke-width="2" stroke="black" id="elipsHV"/>
                <ellipse cx="100" cy="210" rx="80" ry="20" fill="#075500" stroke-width="2" stroke="black" id="elipsBV"/>
            </g>
            <g transform="translate(0, 420)">
                <rect x="20" y="50" width="160" height="160" fill="white" stroke-width="2" stroke="black"/>
                <ellipse cx="100" cy="50" rx="80" ry="20" fill="white" stroke-width="2" stroke="black"/>
                <rect x="20" y="110" width="160" height="100" fill="#8bb9f5" stroke-width="2" stroke="black" id="cuveB"/>
                <ellipse cx="100" cy="110" rx="80" ry="20" fill="#003ce0" stroke-width="2" stroke="black" id="elipsHB"/>
                <ellipse cx="100" cy="210" rx="80" ry="20" fill="#004280" stroke-width="2" stroke="black" id="elipsBB"/>
            </g>
            <g>
                <line x1="180" y1="160" x2="330" y2="160" stroke-width="5" stroke="black" />
                <g id="rouge">
                    <circle cx="250" cy="160" r="15" fill="black" />
                    <line x1="250" y1="135" x2="250" y2="185" stroke-width="5" stroke="black" /> <!--robinet rouge -->
                </g>
                <line x1="180" y1="380" x2="330" y2="380" stroke-width="5" stroke="black" />
                <g id="vert">
                    <circle cx="250" cy="380" r="15" fill="black" />
                    <line x1="250" y1="355" x2="250" y2="405" stroke-width="5" stroke="black" /> <!--robinet vert -->
                </g>
                <line x1="180" y1="560" x2="330" y2="560" stroke-width="5" stroke="black" />
                <g id="bleu">
                    <circle cx="250" cy="560" r="15" fill="black" />
                    <line x1="250" y1="535" x2="250" y2="585" stroke-width="5" stroke="black" /> <!--robinet bleu -->
                </g>
                <line x1="330" y1="160" x2="330" y2="560" stroke-width="5" stroke="black" />
                <line x1="330" y1="480" x2="520" y2="480" stroke-width="5" stroke="black" />
            </g>
            <g transform="translate(500, 100)">
                <rect x="20" y="50" width="160" height="480" fill="white" stroke-width="2" stroke="black"/>
                <rect x="20" y="530" width="160" height="0" fill="none" stroke-width="2" stroke="black" id="rect" />
                <ellipse cx="100" cy="50" rx="80" ry="20" fill="white" stroke-width="2" stroke="black"/>
                <ellipse cx="100" cy="530" rx="80" ry="20" fill="none" stroke-width="2" stroke="black" id="elipsH"/>
                <ellipse cx="100" cy="530" rx="80" ry="20" fill="none" stroke-width="2" stroke="black" id="elipsB"/>
            </g>
            <g>
                <rect x="380" y="30" width="70" height="135" fill="white" stroke-width="4" stroke="black"/>
                <circle cx="415" cy="65" r="30" fill="none" stroke-width="1" stroke="black" id="feuR" />
                <circle cx="415" cy="130" r="30" fill="none" stroke-width="1" stroke="black" id="feuV" />
            </g>
        </svg>    

    </body>

    <script type="text/javascript">
        r= document.getElementById("rouge");
        v= document.getElementById("vert");
        b= document.getElementById("bleu");
        feuV= document.getElementById("feuV");
        feuR= document.getElementById("feuR");
        rect= document.getElementById("rect");
        elipsH= document.getElementById("elipsH");
        elipsB= document.getElementById("elipsB");
        cuveR= document.getElementById("cuveR");
        cuveV= document.getElementById("cuveV");
        cuveB= document.getElementById("cuveB");
        elipsHR= document.getElementById("elipsHR");
        elipsHV= document.getElementById("elipsHV");
        elipsHB= document.getElementById("elipsHB");
        elipsBR= document.getElementById("elipsBR");
        elipsBV= document.getElementById("elipsBV");
        elipsBB= document.getElementById("elipsBB");
        etatR = new Array(false, 50, 160, "red"); // robinet, height, y, couleur
        etatV = new Array(false, 160, 50, "green");
        etatB = new Array(false, 100, 110, "blue");
        etatFinal = new Array(0, 530); // height, y
        var percentR = 0;
        var percentV = 0;
        var percentB = 0;

        r.onclick = function() {
            if(etatR[0] == false) {
                r.setAttribute("transform", "rotate(90, 250 ,160)");
                etatR[0] = true;
                Remplir(etatR, cuveR, elipsHR, elipsBR);
            } else {
                r.setAttribute("transform", "rotate(0, 250 ,160)");
                etatR[0] = false;
            }
        };
        v.onclick = function() {
            if(etatV[0] == false) {
                v.setAttribute("transform", "rotate(90, 250 ,380)");
                etatV[0] = true;
                Remplir(etatV, cuveV, elipsHV, elipsBV);
            } else {
                v.setAttribute("transform", "rotate(0, 250 ,380)");
                etatV[0] = false;
            }
        };
        b.onclick = function() {
            if(etatB[0] == false) {
                b.setAttribute("transform", "rotate(90, 250 ,560)");
                etatB[0] = true;
                Remplir(etatB, cuveB, elipsHB, elipsBB);
            } else {
                b.setAttribute("transform", "rotate(0, 250 ,560)");
                etatB[0] = false;
            }
        };

        async function Remplir(etat, cuve, elipsHaute, elipsBasse) {
            if (etat[1] > 0 && etat[0] == true) {
                feuV.style.fill="green";
                if (etat[3] == "red") {
                    red = (etat[2]-160)*1.59375;
                    percentR = Math.round(red/255*100);
                } else if (etat[3] == "green") {
                    green = (etat[2]-50)*1.59375;
                    percentV = Math.round(green/255*100);
                } else {
                    blue = (etat[2]-110)*1.59375;
                    percentB = Math.round(blue/255*100);
                }
                etatFinal[0]=etatFinal[0]+0.25;
                etatFinal[1]=etatFinal[1]-0.25;
                rect.setAttribute("height", etatFinal[0]);
                rect.setAttribute("y", etatFinal[1]);
                elipsH.setAttribute("cy", etatFinal[1]);
                etat[1]=etat[1]-0.25;
                etat[2]=etat[2]+0.25;
                cuve.setAttribute("height", etat[1]);
                cuve.setAttribute("y", etat[2]);
                elipsHaute.setAttribute("cy", etat[2]);
                rect.style.fill=`rgb(${percentR}%,${percentV}%,${percentB}%)`;
                elipsH.style.fill=`rgb(${percentR}%,${percentV}%,${percentB}%)`;
                elipsB.style.fill=`rgb(${percentR}%,${percentV}%,${percentB}%)`;
                await sleep(15);
                Remplir(etat, cuve, elipsHaute, elipsBasse);
            } else if (etat[1] == 0) {
                feuR.style.fill="red";
                cuve.style.fill="none";
                elipsHaute.style.fill="none";
                elipsBasse.style.fill="none";
            } 
            if (etat[0] == false) {
                feuV.style.fill="none";
            }
        }

        function sleep(ms) {
            return new Promise(
                resolve => setTimeout(resolve, ms)
            );
        }
    </script>
</html>